<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Goal Planning Calculator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4"></script>
    <style>
        /* Custom styles for Chart.js responsiveness */
        canvas {
            width: 100% !important;
            height: auto !important;
        }
    </style>
</head>
<body class="bg-gray-100 p-2 font-sans">
    <div class="calculator-container bg-white shadow-lg rounded-xl p-6 max-w-lg w-full mx-auto sm:p-8">
        <h2 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-5 sm:mb-6">Financial Goal Planning Calculator</h2>

        <div class="space-y-3 sm:space-y-4 mb-5 sm:mb-6">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between">
                <label for="goalAmount" class="text-gray-700 text-base sm:text-lg sm:w-1/2">Future Goal Amount (â‚¹):</label>
                <input type="number" id="goalAmount" value="100000" autofocus class="flex-grow p-2 sm:p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-base sm:text-lg sm:w-1/2">
            </div>
            <div class="flex flex-col sm:flex-row sm:items-center justify-between">
                <label for="inflationRate" class="text-gray-700 text-base sm:text-lg sm:w-1/2">Rate of Inflation (p.a.) (%):</label>
                <input type="number" id="inflationRate" value="8" step="0.1" class="flex-grow p-2 sm:p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-base sm:text-lg sm:w-1/2">
            </div>
            <div class="flex flex-col sm:flex-row sm:items-center justify-between">
                <label for="years" class="text-gray-700 text-base sm:text-lg sm:w-1/2">Time Period (Years):</label>
                <input type="number" id="years" value="10" class="flex-grow p-2 sm:p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-base sm:text-lg sm:w-1/2">
            </div>
            <div class="flex flex-col sm:flex-row sm:items-center justify-between">
                <label for="returnRate" class="text-gray-700 text-base sm:text-lg sm:w-1/2">Returns on Savings (p.a.) (%):</label>
                <input type="number" id="returnRate" value="6" step="0.1" class="flex-grow p-2 sm:p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-base sm:text-lg sm:w-1/2">
            </div>
        </div>

        <button onclick="calculateGoal()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 sm:py-3 px-4 rounded-lg transition duration-300 ease-in-out text-lg sm:text-xl">
            Calculate
        </button>

        <!-- Use Tailwind's hidden class for robust hiding -->
        <div class="results mt-6 sm:mt-8 p-4 sm:p-6 bg-gray-50 rounded-lg shadow-inner hidden" id="results">
            <p id="displayInflatedGoal" class="text-base sm:text-xl text-gray-800 mb-1 sm:mb-2"></p>
            <p id="displayMonthlyInvestment" class="text-base sm:text-xl text-gray-800 mb-2 sm:mb-4"></p>
            <canvas id="goalChart" class="mt-2 sm:mt-4"></canvas>
        </div>
    </div>

    <script>
        // Function to format currency in INR
        function formatINR(x) {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR'
            }).format(x);
        }

        // Global variable for chart instance
        let goalChartInstance = null;

        // Function to calculate financial goals and update the UI
        function calculateGoal() {
            // Get input values
            const goalAmount = parseFloat(document.getElementById('goalAmount').value);
            const inflationRate = parseFloat(document.getElementById('inflationRate').value);
            const years = parseFloat(document.getElementById('years').value);
            const returnRate = parseFloat(document.getElementById('returnRate').value);

            // Validate inputs
            if (isNaN(goalAmount) || isNaN(inflationRate) || isNaN(years) || isNaN(returnRate) ||
                goalAmount <= 0 || years <= 0) {
                // Using a custom modal for alerts instead of alert()
                showModal('Please enter valid positive numbers for all fields.');
                return;
            }

            // Calculate inflated goal amount
            const inflatedGoal = goalAmount * Math.pow(1 + inflationRate / 100, years);

            // Calculate monthly investment required (future value of annuity formula)
            const monthlyRate = returnRate / 12 / 100;
            const totalMonths = years * 12;

            let monthlyInvestment;
            if (monthlyRate === 0) {
                // Handle case where return rate is 0 to avoid division by zero
                monthlyInvestment = inflatedGoal / totalMonths;
            } else {
                monthlyInvestment = inflatedGoal * monthlyRate / (Math.pow(1 + monthlyRate, totalMonths) - 1);
            }

            // Display results
            document.getElementById('displayInflatedGoal').innerText = "Future Goal Amount (inflation-adjusted): " + formatINR(inflatedGoal);
            document.getElementById('displayMonthlyInvestment').innerText = "Monthly Investment Required: " + formatINR(monthlyInvestment);
            
            // Show the results div by removing the 'hidden' class
            document.getElementById('results').classList.remove('hidden');

            // Get canvas context for Chart.js
            const ctx = document.getElementById('goalChart').getContext('2d');

            // Destroy existing chart instance if it exists
            if (goalChartInstance) {
                goalChartInstance.destroy();
            }

            // Create new Chart.js instance (Pie chart for illustration)
            goalChartInstance = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Total Investment', 'Total Future Goal Amount'],
                    datasets: [{
                        data: [monthlyInvestment * totalMonths, inflatedGoal], // Showing total investment vs total goal for pie chart relevance
                        backgroundColor: ['#34D399', '#EF4444'], // Tailwind green-400 and red-500
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    legend: {
                        position: 'bottom',
                        labels: {
                            fontColor: '#374151', // Gray-700
                            fontSize: 12, // Decreased font size for legend
                            padding: 0 // Decreased padding for legend labels
                        }
                    },
                    title: {
                        display: true,
                        text: 'Investment Contribution vs. Goal',
                        fontSize: 16, // Decreased font size for title
                        fontColor: '#1F2937', // Gray-900
                        padding: 8 // Decreased padding for title
                    },
                    tooltips: {
                        callbacks: {
                            label: function(tooltipItem, data) {
                                let label = data.labels[tooltipItem.index] || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += formatINR(data.datasets[0].data[tooltipItem.index]);
                                return label;
                            }
                        },
                        titleFontSize: 14, // Decreased font size for tooltip title
                        bodyFontSize: 12 // Decreased font size for tooltip body
                    }
                }
            });
        }

        // Custom modal functions (replacing alert())
        function showModal(message) {
            let modal = document.getElementById('customAlertModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'customAlertModal';
                modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                        <p class="text-gray-800 text-center mb-4 text-lg">${message}</p>
                        <button onclick="closeModal()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-lg">
                            OK
                        </button>
                    </div>
                `;
                document.body.appendChild(modal);
            } else {
                modal.querySelector('p').innerText = message;
                modal.style.display = 'flex';
            }
        }

        function closeModal() {
            const modal = document.getElementById('customAlertModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>
